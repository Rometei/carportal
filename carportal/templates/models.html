<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–æ–¥–µ–ª–∏</title>
    <link rel="stylesheet" href="{% static 'styles.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .rating-container {
            margin: 10px 0;
        }
        .like-btn, .dislike-btn {
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background: #f0f0f0;
        }
        .like-btn.active {
            background: #4CAF50;
            color: white;
        }
        .dislike-btn.active {
            background: #f44336;
            color: white;
        }
        .total-rating {
            margin-left: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="{% url 'index' %}">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="{% url 'models' %}">–ú–æ–¥–µ–ª–∏</a></li>
                <li><a href="{% url 'contact' %}">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                {% if user.is_authenticated %}
                <li><a href="{% url 'feedback' %}">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</a></li>
                <li><a href="{% url 'user_logout' %}">–í—ã–π—Ç–∏</a></li>
                {% else %}
                <li><a href="{% url 'registration' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></li>
                <li><a href="{% url 'user_login' %}">–í–æ–π—Ç–∏</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>

    <main>
        <h1>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</h1>
        <p>–ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º—ã —Ä–∞—Å—Å–∫–∞–∂–µ–º –æ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–≤–æ–µ–≤–∞–ª–∏ –ª—é–±–æ–≤—å –º–∏–ª–ª–∏–æ–Ω–æ–≤ –ª—é–¥–µ–π –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É. –≠—Ç–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é, —Å—Ç–∏–ª—å–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º –∏ –ø–µ—Ä–µ–¥–æ–≤—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏.</p>

        <h2>Toyota Camry</h2>
        <p>Toyota Camry ‚Äî —ç—Ç–æ –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å–µ–¥–∞–Ω–æ–≤ –≤ –º–∏—Ä–µ. –û–Ω —Å–æ—á–µ—Ç–∞–µ—Ç –≤ —Å–µ–±–µ –∫–æ–º—Ñ–æ—Ä—Ç, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ—Å—Ç—å. Camry –æ—Å–Ω–∞—â–µ–Ω —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –º—É–ª—å—Ç–∏–º–µ–¥–∏–∞, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –æ—Ç–ª–∏—á–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –¥–ª—è —Å–µ–º—å–∏.</p>
        <img src="{% static 'images/camry.jpg' %}" alt="Toyota Camry">
        <div class="rating-container" data-model="Toyota Camry">
            <button class="like-btn" data-value="1">üëç <span class="like-count">0</span></button>
            <button class="dislike-btn" data-value="-1">üëé <span class="dislike-count">0</span></button>
            <span class="total-rating">–†–µ–π—Ç–∏–Ω–≥: 0</span>
        </div>

        <h2>Honda Civic</h2>
        <p>Honda Civic ‚Äî —ç—Ç–æ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Å–ª—É–∂–∏–ª —Ä–µ–ø—É—Ç–∞—Ü–∏—é –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –∏ —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞. Civic –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç—å –∏ —Å—Ç–∏–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–º —Å—Ä–µ–¥–∏ –º–æ–ª–æ–¥–µ–∂–∏.</p>
        <img src="{% static 'images/civic.jpg' %}" alt="Honda Civic">
        <div class="rating-container" data-model="Honda Civic">
            <button class="like-btn" data-value="1">üëç <span class="like-count">0</span></button>
            <button class="dislike-btn" data-value="-1">üëé <span class="dislike-count">0</span></button>
            <span class="total-rating">–†–µ–π—Ç–∏–Ω–≥: 0</span>
        </div>

        <h2>Ford Mustang</h2>
        <p>Ford Mustang ‚Äî —ç—Ç–æ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–∞–ª —Å–∏–º–≤–æ–ª–æ–º –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω–æ–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏. Mustang –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –º–æ—â–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –∏ –Ω–µ–ø—Ä–µ–≤–∑–æ–π–¥–µ–Ω–Ω—É—é –¥–∏–Ω–∞–º–∏–∫—É.</p>
        <img src="{% static 'images/mustang.jpg' %}" alt="Ford Mustang">
        <div class="rating-container" data-model="Ford Mustang">
            <button class="like-btn" data-value="1">üëç <span class="like-count">0</span></button>
            <button class="dislike-btn" data-value="-1">üëé <span class="dislike-count">0</span></button>
            <span class="total-rating">–†–µ–π—Ç–∏–Ω–≥: 0</span>
        </div>

        <h2>BMW 3 Series</h2>
        <p>BMW 3 Series ‚Äî —ç—Ç–æ –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–π —Å–µ–¥–∞–Ω, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—á–µ—Ç–∞–µ—Ç –≤ —Å–µ–±–µ —Ä–æ—Å–∫–æ—à—å, –∫–æ–º—Ñ–æ—Ä—Ç –∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏. –û–Ω –æ—Å–Ω–∞—â–µ–Ω –ø–µ—Ä–µ–¥–æ–≤—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—é –Ω–µ–ø—Ä–µ–≤–∑–æ–π–¥–µ–Ω–Ω—ã–π –æ–ø—ã—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.</p>
        <img src="{% static 'images/bmw3.jpg' %}" alt="BMW 3 Series">
        <div class="rating-container" data-model="BMW 3 Series">
            <button class="like-btn" data-value="1">üëç <span class="like-count">0</span></button>
            <button class="dislike-btn" data-value="-1">üëé <span class="dislike-count">0</span></button>
            <span class="total-rating">–†–µ–π—Ç–∏–Ω–≥: 0</span>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 –ê–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç–∞–ª</p>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞
        function updateRating(model) {
            fetch(`/likes/${model}/`)
                .then(response => response.json())
                .then(data => {
                    const container = document.querySelector(`.rating-container[data-model="${model}"]`);
                    container.querySelector('.like-count').textContent = data.likes;
                    container.querySelector('.dislike-count').textContent = data.dislikes;
                    container.querySelector('.total-rating').textContent = `–†–µ–π—Ç–∏–Ω–≥: ${data.total}`;

                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
                    container.querySelector('.like-btn').classList.remove('active');
                    container.querySelector('.dislike-btn').classList.remove('active');

                    if (data.user_vote === 1) {
                        container.querySelector('.like-btn').classList.add('active');
                    } else if (data.user_vote === -1) {
                        container.querySelector('.dislike-btn').classList.add('active');
                    }
                });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ª–∞–π–∫–æ–≤/–¥–∏–∑–ª–∞–π–∫–æ–≤
        document.querySelectorAll('.like-btn, .dislike-btn').forEach(button => {
            button.addEventListener('click', function() {
                {% if not user.is_authenticated %}
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –º–æ–¥–µ–ª–∏');
                    return;
                {% endif %}

                const container = this.closest('.rating-container');
                const model = container.dataset.model;
                const value = parseInt(this.dataset.value);

                fetch('/like/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}',
                    },
                    body: JSON.stringify({
                        car_model: model,
                        value: value
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'ok') {
                        updateRating(model);
                    } else {
                        console.error('–û—à–∏–±–∫–∞:', data.message);
                    }
                });
            });
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.querySelectorAll('.rating-container').forEach(container => {
            updateRating(container.dataset.model);
        });

        // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        setInterval(function() {
            document.querySelectorAll('.rating-container').forEach(container => {
                updateRating(container.dataset.model);
            });
        }, 5000); // 5000 –º—Å = 5 —Å–µ–∫—É–Ω–¥
    });
    </script>
</body>
</html>